<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>白娘子大戰法海</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = { theme: { extend: { colors: { primary: '#d92121', secondary: '#1a56db', light: '#f3f4f6', dark: '#1f2937', gold: '#d97706', snake: '#059669', buddha: '#f59e0b' }, fontFamily: { sans: ['Noto Sans SC', 'sans-serif'] } } }
    </script>
    <style type="text/tailwindcss">
        @layer utilities { .text-shadow { text-shadow: 2px 2px 4px rgba(0,0,0,0.5); } .glow { filter: drop-shadow(0 0 8px currentColor); } .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4,0,0.6,1) infinite; } .animate-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; } .animate-float { animation: float 3s ease-in-out infinite; } .animate-break { animation: break 0.6s cubic-bezier(.36,.07,.19,.97) forwards; } .animate-wave { animation: wave 2s ease-in-out forwards; } .animate-fire { animation: fire 1s ease-in-out infinite; } .animate-snake { animation: snake 1.5s ease-in-out infinite; } .animate-lightning { animation: lightning 0.3s ease-in-out infinite; } .animate-wind { animation: wind 3s linear infinite; } .hp-bar { height: 12px; transition: width 0.5s ease-in-out; } .modal-backdrop { backdrop-filter: blur(5px); } }
        @keyframes shake { 10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-3px)}40%,60%{transform:translateX(3px)} }
        @keyframes float { 0%{transform:translateY(0)}50%{transform:translateY(-10px)}100%{transform:translateY(0)} }
        @keyframes break { 0%{transform:scale(1);opacity:1}50%{transform:scale(1.2);opacity:.8}100%{transform:scale(0);opacity:0} }
        @keyframes wave { 0%{transform:translateY(100vh);opacity:.7}70%{transform:translateY(-20vh);opacity:.7}100%{transform:translateY(-100vh);opacity:0} }
        @keyframes fire { 0%{transform:scale(1);opacity:.8}50%{transform:scale(1.1);opacity:1}100%{transform:scale(1);opacity:.8} }
        @keyframes snake { 0%{transform:translateX(0) rotate(0deg)}25%{transform:translateX(10px) rotate(5deg)}50%{transform:translateX(0) rotate(0deg)}75%{transform:translateX(-10px) rotate(-5deg)}100%{transform:translateX(0) rotate(0deg)} }
        @keyframes lightning { 0%,100%{opacity:0.3}50%{opacity:1} }
        @keyframes wind { 0%{transform:rotate(0deg)}100%{transform:rotate(360deg)} }
    </style>
</head>
<body class="bg-gray-900 text-light min-h-screen overflow-hidden font-sans">
    <div id="start-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-black">
        <div id="scholar" class="w-48 h-64 bg-contain bg-no-repeat bg-center mb-8" style="background-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 150\"><rect x=\"30\" y=\"20\" width=\"40\" height=\"60\" fill=\"%238B4513\"/><circle cx=\"50\" cy=\"15\" r=\"10\" fill=\"%23FFD700\"/><path d=\"M30 80 L50 120 L70 80 Z\" fill=\"%238B4513\"/><path d=\"M40 40 L60 40 L55 60 L45 60 Z\" fill=\"%23F5DEB3\"/></svg>')"></div>
        <div id="pokeball" class="w-16 h-16 rounded-full bg-red-600 border-4 border-black relative animate-float cursor-pointer">
            <div class="absolute inset-0 flex items-center justify-center"><div class="w-full h-1 bg-black"></div><div class="w-4 h-4 rounded-full bg-white border-2 border-black absolute"></div></div>
            <div class="absolute bottom-0 w-full h-1/2 bg-white rounded-b-full"></div>
        </div>
        <p class="mt-8 text-xl text-shadow">點擊精靈球開始遊戲</p>
    </div>
    <div id="glass-shatter" class="fixed inset-0 z-40 hidden pointer-events-none"></div>
    <div id="game-screen" class="hidden relative w-full h-screen">
        <div class="relative h-3/5 flex justify-between items-end px-8 pb-8">
            <div class="flex flex-col items-center">
                <div class="bg-dark/70 rounded-lg p-2 mb-2 flex items-center">
                    <h2 class="text-xl font-bold mr-2">白娘子</h2>
                    <div class="w-48 bg-gray-700 rounded-full h-2"><div id="player-hp" class="hp-bar bg-green-500 rounded-full" style="width:100%"></div></div>
                    <span id="player-hp-text" class="ml-2 text-sm">15000/15000</span>
                </div>
                <div id="player-sprite" class="w-64 h-64 bg-contain bg-no-repeat bg-center transition-all duration-500" style="background-image: url('https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/00dad4ef1d9a4f92a6e8094910c40e0f.png~tplv-a9rns2rl98-24:720:720.image?rcl=202512062326166194D2D530B0894FFBB8&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765639576&x-signature=wi2fu9rqgpyHq8DmscJW7gUra%2Bc%3D')"></div>
            </div>
            <div class="flex flex-col items-center">
                <div class="bg-dark/70 rounded-lg p-2 mb-2 flex items-center">
                    <h2 class="text-xl font-bold mr-2">法海</h2>
                    <div class="w-48 bg-gray-700 rounded-full h-2"><div id="enemy-hp" class="hp-bar bg-green-500 rounded-full" style="width:100%"></div></div>
                    <span id="enemy-hp-text" class="ml-2 text-sm">20000/20000</span>
                </div>
                <div id="enemy-sprite" class="w-64 h-64 bg-contain bg-no-repeat bg-center transition-all duration-500" style="background-image: url('https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/b93fffd3875e4e3bbc4bb8b9401d24c1.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=202512062326166194D2D530B0894FFBB8&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765639576&x-signature=2LE%2BtqVkGGuj48LYMxfR7Emoo%2BI%3D')"></div>
            </div>
        </div>
        <div id="message-box" class="absolute top-1/4 left-1/2 transform -translate-x-1/2 bg-dark/80 rounded-lg p-4 w-1/2 text-center h-16 flex items-center justify-center text-lg">戰鬥開始!</div>
        <div id="effect-layer" class="fixed inset-0 pointer-events-none z-10 hidden"></div>
        <div class="relative h-2/5 bg-dark/80 p-4">
            <div id="main-actions" class="grid grid-cols-2 gap-4 h-full">
                <button id="attack-btn" class="bg-primary hover:bg-primary/80 text-white rounded-lg p-4 text-xl flex items-center justify-center transition-all transform hover:scale-105"><i class="fa fa-fist-raised mr-2"></i> 攻擊</button>
                <button id="skills-btn" class="bg-secondary hover:bg-secondary/80 text-white rounded-lg p-4 text-xl flex items-center justify-center transition-all transform hover:scale-105"><i class="fa fa-magic mr-2"></i> 技能</button>
                <button id="transform-btn" class="bg-snake hover:bg-snake/80 text-white rounded-lg p-4 text-xl flex items-center justify-center transition-all transform hover:scale-105"><i class="fa fa-exchange mr-2"></i> 變身</button>
                <button id="defend-btn" class="bg-gray-600 hover:bg-gray-500 text-white rounded-lg p-4 text-xl flex items-center justify-center transition-all transform hover:scale-105"><i class="fa fa-shield mr-2"></i> 防禦</button>
            </div>
            <div id="skills-menu" class="grid grid-cols-2 gap-4 h-full hidden">
                <button data-skill="1" class="bg-snake hover:bg-snake/80 text-white rounded-lg p-4 text-lg flex flex-col items-center justify-center transition-all transform hover:scale-105"><i class="fa fa-sync-alt mb-1"></i> 萬蛇<br><small>(冷卻: 0)</small></button>
                <button data-skill="2" class="bg-pink-600 hover:bg-pink-500 text-white rounded-lg p-4 text-lg flex flex-col items-center justify-center transition-all transform hover:scale-105"><i class="fa fa-seedling mb-1"></i> 蓮花之幻<br><small>(冷卻: 0)</small></button>
                <button data-skill="3" class="bg-green-600 hover:bg-green-500 text-white rounded-lg p-4 text-lg flex flex-col items-center justify-center transition-all transform hover:scale-105"><i class="fa fa-wind mb-1"></i> 青蛇的吐息<br><small>(冷卻: 0)</small></button>
                <button data-skill="4" class="bg-blue-600 hover:bg-blue-500 text-white rounded-lg p-4 text-lg flex flex-col items-center justify-center transition-all transform hover:scale-105 opacity-50 cursor-not-allowed" id="ultimate-skill"><i class="fa fa-water mb-1"></i> 水漫金山<br><small>(需2次普攻解鎖)</small></button>
                <button id="back-btn" class="col-span-2 bg-gray-600 hover:bg-gray-500 text-white rounded-lg p-4 text-xl flex items-center justify-center transition-all transform hover:scale-105"><i class="fa fa-arrow-left mr-2"></i> 返回</button>
            </div>
        </div>
        <div id="result-screen" class="fixed inset-0 z-20 hidden items-center justify-center bg-black/80 modal-backdrop">
            <div class="bg-dark p-8 rounded-xl text-center">
                <h2 id="result-text" class="text-4xl font-bold mb-6"></h2>
                <button id="restart-btn" class="bg-primary hover:bg-primary/80 text-white rounded-lg p-4 text-xl transition-all transform hover:scale-105">再玩一次</button>
            </div>
        </div>
    </div>
    <script>
        const gameState={player:{hp:15000,maxHp:15000,attack:200,transformed:false,defense:false,attackBoost:1,damageReduction:1,normalAttackCount:0,ultimateUnlocked:false},enemy:{hp:20000,maxHp:20000,attack:160,baseAttack:160,defense:false,attackBoost:1,form:1},skills:{1:{cooldown:0,maxCooldown:2},2:{cooldown:0,maxCooldown:3},3:{cooldown:0,maxCooldown:3},4:{cooldown:0,maxCooldown:5}},enemySkills:{1:{cooldown:0,maxCooldown:2},2:{cooldown:0,maxCooldown:3},3:{cooldown:0,maxCooldown:0}},playerTurn:true,gameOver:false,transformUsed:false};
        const startScreen=document.getElementById('start-screen');
        const gameScreen=document.getElementById('game-screen');
        const pokeball=document.getElementById('pokeball');
        const glassShatter=document.getElementById('glass-shatter');
        const playerHp=document.getElementById('player-hp');
        const playerHpText=document.getElementById('player-hp-text');
        const enemyHp=document.getElementById('enemy-hp');
        const enemyHpText=document.getElementById('enemy-hp-text');
        const messageBox=document.getElementById('message-box');
        const attackBtn=document.getElementById('attack-btn');
        const skillsBtn=document.getElementById('skills-btn');
        const transformBtn=document.getElementById('transform-btn');
        const defendBtn=document.getElementById('defend-btn');
        const mainActions=document.getElementById('main-actions');
        const skillsMenu=document.getElementById('skills-menu');
        const backBtn=document.getElementById('back-btn');
        const ultimateSkill=document.getElementById('ultimate-skill');
        const effectLayer=document.getElementById('effect-layer');
        const playerSprite=document.getElementById('player-sprite');
        const enemySprite=document.getElementById('enemy-sprite');
        const resultScreen=document.getElementById('result-screen');
        const resultText=document.getElementById('result-text');
        const restartBtn=document.getElementById('restart-btn');
        const skillButtons=document.querySelectorAll('[data-skill]');
        function initGame(){
            pokeball.addEventListener('click',startGame);
            attackBtn.addEventListener('click',playerAttack);
            skillsBtn.addEventListener('click',showSkillsMenu);
            backBtn.addEventListener('click',showMainActions);
            transformBtn.addEventListener('click',playerTransform);
            defendBtn.addEventListener('click',playerDefend);
            restartBtn.addEventListener('click',restartGame);
            skillButtons.forEach(btn=>btn.addEventListener('click',()=>{const skillId=parseInt(btn.dataset.skill);useSkill(skillId);}));
        }
        function startGame(){
            pokeball.classList.add('animate-break');
            setTimeout(()=>{
                glassShatter.classList.remove('hidden');
                createGlassShatterEffect();
                setTimeout(()=>{
                    startScreen.classList.add('hidden');
                    gameScreen.classList.remove('hidden');
                    glassShatter.classList.add('hidden');
                },600);
            },500);
        }
        function createGlassShatterEffect(){
            for(let i=0;i<20;i++){
                const shard=document.createElement('div');
                const size=Math.random()*30+10;
                const x=Math.random()*100;
                const y=Math.random()*100;
                const rot=Math.random()*360;
                const duration=Math.random()*1+0.5;
                const delay=Math.random()*0.5;
                shard.style.position='absolute';
                shard.style.width=`${size}px`;
                shard.style.height=`${size}px`;
                shard.style.background='rgba(255,255,255,0.3)';
                shard.style.left=`${x}%`;
                shard.style.top=`${y}%`;
                shard.style.transform=`rotate(${rot}deg)`;
                shard.style.clipPath=`polygon(${Math.random()*30+20}%,${Math.random()*30+20}%, ${Math.random()*30+50}%,${Math.random()*30+10}%, ${Math.random()*30+70}%,${Math.random()*30+30}%, ${Math.random()*30+60}%,${Math.random()*30+60}%, ${Math.random()*30+30}%,${Math.random()*30+70}%)`;
                shard.style.animation=`break ${duration}s ease-out ${delay}s forwards`;
                glassShatter.appendChild(shard);
            }
        }
        function updateHpDisplays(){
            const playerHpPercent=(gameState.player.hp/gameState.player.maxHp)*100;
            const enemyHpPercent=(gameState.enemy.hp/gameState.enemy.maxHp)*100;
            playerHp.style.width=`${playerHpPercent}%`;
            playerHpText.textContent=`${gameState.player.hp}/${gameState.player.maxHp}`;
            enemyHp.style.width=`${enemyHpPercent}%`;
            enemyHpText.textContent=`${gameState.enemy.hp}/${gameState.enemy.maxHp}`;
            if(playerHpPercent<30){
                playerHp.classList.remove('bg-green-500','bg-yellow-500');
                playerHp.classList.add('bg-red-500');
            }else if(playerHpPercent<60){
                playerHp.classList.remove('bg-green-500','bg-red-500');
                playerHp.classList.add('bg-yellow-500');
            }else{
                playerHp.classList.remove('bg-yellow-500','bg-red-500');
                playerHp.classList.add('bg-green-500');
            }
            if(enemyHpPercent<30){
                enemyHp.classList.remove('bg-green-500','bg-yellow-500');
                enemyHp.classList.add('bg-red-500');
            }else if(enemyHpPercent<60){
                enemyHp.classList.remove('bg-green-500','bg-red-500');
                enemyHp.classList.add('bg-yellow-500');
            }else{
                enemyHp.classList.remove('bg-yellow-500','bg-red-500');
                enemyHp.classList.add('bg-green-500');
            }
            if(enemyHpPercent<=45&&gameState.enemy.form!==2){
                gameState.enemy.form=2;
                enemySprite.style.backgroundImage="url('https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/941eec7ebf5c4ab192ec4855db69e875.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=20251207104753AC5844D95824F4534A67&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765680474&x-signature=UR51iwTVYd0clVrfD4%2FBXyv94M8%3D')";
            }else if(enemyHpPercent>45&&gameState.enemy.form!==1){
                gameState.enemy.form=1;
                enemySprite.style.backgroundImage="url('https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/b93fffd3875e4e3bbc4bb8b9401d24c1.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=202512062326166194D2D530B0894FFBB8&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765639576&x-signature=2LE%2BtqVkGGuj48LYMxfR7Emoo%2BI%3D')";
            }
        }
        function updateSkillCooldowns(){
            skillButtons.forEach(btn=>{
                const skillId=parseInt(btn.dataset.skill);
                const skill=gameState.skills[skillId];
                if(skill.cooldown>0){
                    btn.innerHTML=`${btn.innerHTML.split('<br>')[0]}<br><small>(冷卻: ${skill.cooldown})</small>`;
                    btn.classList.add('opacity-50','cursor-not-allowed');
                    btn.disabled=true;
                }else{
                    btn.innerHTML=`${btn.innerHTML.split('<br>')[0]}<br><small>(冷卻: 0)</small>`;
                    btn.classList.remove('opacity-50','cursor-not-allowed');
                    btn.disabled=false;
                }
            });
            if(gameState.player.ultimateUnlocked&&gameState.skills[4].cooldown===0){
                ultimateSkill.classList.remove('opacity-50','cursor-not-allowed');
                ultimateSkill.disabled=false;
                ultimateSkill.innerHTML='<i class="fa fa-water mb-1"></i> 水漫金山<br><small>(冷卻: 0)</small>';
            }
        }
        function reduceCooldowns(){
            for(const key in gameState.skills)if(gameState.skills[key].cooldown>0)gameState.skills[key].cooldown--;
            for(const key in gameState.enemySkills)if(gameState.enemySkills[key].cooldown>0)gameState.enemySkills[key].cooldown--;
            updateSkillCooldowns();
        }
        function showSkillsMenu(){
            mainActions.classList.add('hidden');
            skillsMenu.classList.remove('hidden');
            updateSkillCooldowns();
        }
        function showMainActions(){
            skillsMenu.classList.add('hidden');
            mainActions.classList.remove('hidden');
        }
        function playerAttack(){
            if(!gameState.playerTurn||gameState.gameOver)return;
            const damage=Math.floor(gameState.player.attack*gameState.playerexpires=17656.attackBoost);gameState.enemy.hp = Math.max(0, gameState.enemy.hp - damage);showMessage(白娘子對法海造成了${damage}點傷害!);enemySprite.classList.add('animate-shake');gameState.player.normalAttackCount++;if (gameState.player.normalAttackCount >= 2 && !gameState.player.ultimateUnlocked) {gameState.player.ultimateUnlocked = true;ultimateSkill.classList.remove('opacity-50', 'cursor-not-allowed');ultimateSkill.disabled = false;ultimateSkill.innerHTML = '<i class="fa fa-water mb-1"></i> 水漫金山<small>(冷卻: 0)</small>';}setTimeout(() => {enemySprite.classList.remove('animate-shake');updateHpDisplays();reduceCooldowns();if (checkGameOver()) return;gameState.playerTurn = false;setTimeout(enemyTurn, 1000);}, 800);}function playerTransform() {if (!gameState.playerTurn || gameState.gameOver || gameState.transformUsed) return;gameState.transformUsed = true;transformBtn.classList.add('opacity-50', 'cursor-not-allowed');const hpLoss = Math.floor(gameState.player.hp * 0.1);gameState.player.hp = Math.max(0, gameState.player.hp - hpLoss);gameState.player.attack += 500;gameState.player.transformed = true;playerSprite.style.backgroundImage = "url('https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/f7ddc81e581d453d93fee70e3f77e905.png~tplv-a9rns2rl98-24:720:720.image?rcl=202512062326166194D2D530B0894FFBB8&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765639576&x-signature=kJgAm6p6l10UhxNiJEe19Ou1G0k%3D')";showMessage(白娘子變身!損失了${hpLoss}點生命值，攻擊力大幅提升!);setTimeout (() => {updateHpDisplays ();reduceCooldowns ();if (checkGameOver ()) return;gameState.playerTurn = false;setTimeout (enemyTurn, 1000);}, 1500);}function playerDefend () {if (!gameState.playerTurn || gameState.gameOver) return;gameState.player.defense = true;showMessage (' 白娘子進入防禦狀態，減少 70% 受到的傷害！');setTimeout (() => {reduceCooldowns ();gameState.playerTurn = false;setTimeout (enemyTurn, 1000);}, 800);}function useSkill (skillId) {if (!gameState.playerTurn || gameState.gameOver || gameState.skills [skillId].cooldown > 0) return;let damage = 0;let message = '';switch (skillId) {case 1:damage = Math.floor (gameState.player.attack * gameState.player.attackBoost * 1.2);gameState.enemy.hp = Math.max (0, gameState.enemy.hp - damage);const heal = Math.floor (gameState.player.maxHp * 0.05);gameState.player.hp = Math.min (gameState.player.maxHp, gameState.player.hp + heal);message = 白娘子使用了萬蛇!對法海造成了${damage}點傷害，回復了${heal}點生命值!;gameState.skills [skillId].cooldown = gameState.skills [skillId].maxCooldown;showSnakeEffect ();break;case 2:gameState.player.attackBoost *= 1.45;gameState.player.damageReduction = 0.85;message = ' 白娘子使用了蓮花之幻！攻擊力提升 45%，受到的傷害減少 15%!';gameState.skills [skillId].cooldown = gameState.skills [skillId].maxCooldown;showLotusEffect ();break;case 3:damage = Math.floor (gameState.enemy.maxHp * 0.1);gameState.enemy.hp = Math.max (0, gameState.enemy.hp - damage);message = 白娘子使用了青蛇的吐息!對法海造成了${damage}點傷害!;gameState.skills[skillId].cooldown = gameState.skills[skillId].maxCooldown;showGreenSnakeEffect();break;case 4:if (!gameState.player.transformed || !gameState.player.ultimateUnlocked) return;damage = Math.floor(gameState.player.attack * gameState.player.attackBoost * 3.5);gameState.enemy.hp = Math.max(0, gameState.enemy.hp - damage);gameState.enemy.attackBoost *= 0.2;message = 白娘子使用了水漫金山!對法海造成了${damage}點傷害，法海的攻擊力大幅降低!;gameState.skills[skillId].cooldown = gameState.skills[skillId].maxCooldown;showFloodEffect();break;}showMessage(message);enemySprite.classList.add('animate-shake');setTimeout(() => {enemySprite.classList.remove('animate-shake');updateHpDisplays();showMainActions();reduceCooldowns();if (checkGameOver()) return;if (skillId !== 2) {gameState.player.attackBoost = 1;gameState.player.damageReduction = 1;}gameState.playerTurn = false;setTimeout(enemyTurn, 1000);}, 1500);}function enemyTurn() {if (gameState.gameOver) return;const hpPercent = gameState.enemy.hp / gameState.enemy.maxHp;const lostPercent = 1 - hpPercent;gameState.enemy.attackBoost = 1 + (lostPercent / 0.1) * 0.35;if (hpPercent < 0.5) gameState.enemy.attackBoost *= 1.5;const effectiveAttack = Math.floor(gameState.enemy.baseAttack * gameState.enemy.attackBoost);let damage = 0;let message = '';let skillUsed = false;if (gameState.enemy.hp < gameState.enemy.maxHp * 0.3 && !skillUsed) {damage = Math.floor(effectiveAttack * 10.5);gameState.player.hp = Math.max(0, gameState.player.hp - damage * (gameState.player.defense ? 0.3 : 1) * gameState.player.damageReduction);message = 法海使用了雷峰塔!對白娘子造成了${damage}點傷害!;showPagodaEffect();skillUsed = true;} else if (gameState.enemySkills[2].cooldown === 0 && Math.random() < 0.3 && !skillUsed) {damage = Math.floor(effectiveAttack * 6.5);gameState.player.hp = Math.max(0, gameState.player.hp - damage * (gameState.player.defense ? 0.3 : 1) * gameState.player.damageReduction);message = 法海使用了金剛掌!對白娘子造成了${damage}點傷害!;gameState.enemySkills[2].cooldown = gameState.enemySkills[2].maxCooldown;showGoldenPalmEffect();skillUsed = true;} else if (gameState.enemySkills[1].cooldown === 0 && Math.random() < 0.4 && !skillUsed) {gameState.enemy.defense = true;damage = Math.floor(effectiveAttack * 1.2);gameState.player.hp = Math.max(0, gameState.player.hp - damage * (gameState.player.defense ? 0.3 : 1) * gameState.player.damageReduction);message = 法海使用了金鐘罩!減少95%受到的傷害，並對白娘子造成了${damage}點傷害!;gameState.enemySkills[1].cooldown = gameState.enemySkills[1].maxCooldown;showGoldenBellEffect();skillUsed = true;} else if (!skillUsed) {damage = Math.floor(effectiveAttack * 1.5);gameState.player.hp = Math.max(0, gameState.player.hp - damage * (gameState.player.defense ? 0.3 : 1) * gameState.player.damageReduction);message = 法海使用了大威天龍!對白娘子造成了${damage}點傷害!;showDragonEffect ();skillUsed = true;}showMessage (message);playerSprite.classList.add ('animate-shake');setTimeout (() => {playerSprite.classList.remove ('animate-shake');updateHpDisplays ();gameState.player.defense = false;if (checkGameOver ()) return;gameState.playerTurn = true;}, 1500);}function showMessage (text) { messageBox.textContent = text; }function checkGameOver () {if (gameState.player.hp <= 0) {gameState.gameOver = true;showResult (false);return true;} else if (gameState.enemy.hp <= 0) {gameState.gameOver = true;showResult (true);return true;}return false;}function showResult (playerWon) {resultScreen.classList.remove ('hidden');resultScreen.classList.add ('flex');resultText.textContent = playerWon ? ' 恭喜你獲勝了！' : ' 你失敗了！';}function restartGame () {gameState.player = { hp: 15000, maxHp: 15000, attack: 200, transformed: false, defense: false, attackBoost: 1, damageReduction: 1, normalAttackCount: 0, ultimateUnlocked: false };gameState.enemy = { hp: 20000, maxHp: 20000, attack: 160, baseAttack: 160, defense: false, attackBoost: 1, form: 1 };gameState.skills = { 1: { cooldown: 0, maxCooldown: 2 }, 2: { cooldown: 0, maxCooldown: 3 }, 3: { cooldown: 0, maxCooldown: 3 }, 4: { cooldown: 0, maxCooldown: 5 } };gameState.enemySkills = { 1: { cooldown: 0, maxCooldown: 2 }, 2: { cooldown: 0, maxCooldown: 3 }, 3: { cooldown: 0, maxCooldown: 0 } };gameState.playerTurn = true;gameState.gameOver = false;gameState.transformUsed = false;updateHpDisplays ();updateSkillCooldowns ();showMainActions ();resultScreen.classList.add ('hidden');resultScreen.classList.remove ('flex');enemySprite.style.backgroundImage = "url ('https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/b93fffd3875e4e3bbc4bb8b9401d24c1.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=202512062326166194D2D530B0894FFBB8&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765639576&x-signature=2LE%2BtqVkGGuj48LYMxfR7Emoo%2BI%3D')";playerSprite.style.backgroundImage = "url('https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/00dad4ef1d9a4f92a6e8094910c40e0f.png~tplv-a9rns2rl98-24:720:720.image?rcl=202512062326166194D2D530B0894FFBB8&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1765639576&x-signature=wi2fu9rqgpyHq8DmscJW7gUra%2Bc%3D')";transformBtn.classList.remove('opacity-50', 'cursor-not-allowed');ultimateSkill.classList.add('opacity-50', 'cursor-not-allowed');ultimateSkill.disabled = true;ultimateSkill.innerHTML = '<i class="fa fa-water mb-1"></i> 水漫金山<small>(需 2 次普攻解鎖)</small>';showMessage (' 戰鬥開始！');}function showSnakeEffect () {effectLayer.classList.remove ('hidden');effectLayer.innerHTML = <div class="absolute inset-0 flex items-center justify-center"><div class="w-full h-full bg-black/70 absolute"></div><div class="relative z-10 w-full h-full flex items-center justify-center"><div class="w-64 h-64 bg-green-600/30 rounded-full blur-3xl animate-pulse-slow"></div></div></div>;setTimeout(() => {effectLayer.innerHTML = <div class="absolute inset-0 flex items-center justify-center"><div class="w-full h-full bg-black/70 absolute"></div><div class="relative z-10 grid grid-cols-5 grid-rows-5 gap-2 w-full h-full p-8">${Array(25).fill().map(() => <div class="bg-green-500/60 rounded-full animate-break" style="animation-delay: {Math.random()*0.5}s&\#x22;&\#x3E;&\#x3C;/div&\#x3E;`).join('')}</div></div>`; setTimeout(() => { effectLayer.classList.add('hidden'); effectLayer.innerHTML = ''; }, 800); }, 800); } function showLotusEffect() { effectLayer.classList.remove('hidden'); effectLayer.innerHTML = `<div class="absolute inset-0 flex items-center justify-center"><div class="w-full h-full bg-black/50 absolute"></div><div class="relative z-10 w-64 h-64 animate-float"><svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" class="w-full h-full"><path d="M50,10 C30,10 10,30 10,50 C10,70 30,90 50,90 C70,90 90,70 90,50 C90,30 70,10 50,10 Z" fill="\#ff69b4" opacity="0.8"/><path d="M50,20 C35,20 20,35 20,50 C20,65 35,80 50,80 C65,80 80,65 80,50 C80,35 65,20 50,20 Z" fill="\#ff85c0" opacity="0.8"/><path d="M50,30 C40,30 30,40 30,50 C30,60 40,70 50,70 C60,70 70,60 70,50 C70,40 60,30 50,30 Z" fill="\#ffb6c1" opacity="0.8"/><circle cx="50" cy="50" r="10" fill="\#ff69b4" opacity="0.8"/></svg></div></div>`; setTimeout(() => { effectLayer.innerHTML = `<div class="absolute inset-0"><div class="w-full h-full bg-black/50 absolute"></div>{Array(20).fill().map(() => &#x3C;div class=&#x22;absolute w-4 h-4 bg-pink-500 rounded-full animate-break&#x22; style=&#x22;left: ${Math.random()*100}%; top: ${Math.random()*100}%; animation-delay: ${Math.random()*0.5}s&#x22;&#x3E;&#x3C;/div&#x3E;).join('')}</div>; setTimeout(() => { effectLayer.classList.add('hidden'); effectLayer.innerHTML = ''; }, 800); }, 1000); } function showGreenSnakeEffect() { effectLayer.classList.remove('hidden'); effectLayer.innerHTML = <div class="absolute inset-0"><div class="w-full h-full bg-green-900/70 absolute"></div><div class="absolute top-1/4 left-1/4 w-64 h-64 animate-snake"><div class="w-full h-full bg-green-500/20 rounded-full blur-3xl"></div></div>${Array(30).fill().map(() => &#x3C;div class=&#x22;absolute w-16 h-16 bg-green-800/30 rounded-full&#x22; style=&#x22;left: ${Math.random()*100}%; top: ${Math.random()*100}%; animation: float ${Math.random()*2+2}s ease-in-out infinite&#x22;&#x3E;&#x3C;/div&#x3E;).join('')}</div>; setTimeout(() => { effectLayer.classList.add('hidden'); effectLayer.innerHTML = ''; }, 1500); } function showFloodEffect() { effectLayer.classList.remove('hidden'); effectLayer.innerHTML = <div class="absolute inset-0 overflow-hidden"><div class="absolute bottom-0 left-0 w-full h-full bg-blue-600/70 rounded-t-full animate-wave"></div>${Array(10).fill().map(() => &#x3C;div class=&#x22;absolute bg-blue-400 rounded-full animate-break&#x22; style=&#x22;width: ${Math.random()*40+20}px; height: ${Math.random()*40+20}px; left: ${Math.random()*100}%; top: ${Math.random()*50+20}%; animation-delay: ${Math.random()*1}s&#x22;&#x3E;&#x3C;/div&#x3E;).join('')}</div>; setTimeout(() => { effectLayer.classList.add('hidden'); effectLayer.innerHTML = ''; }, 2000); } function showGoldenBellEffect() { effectLayer.classList.remove('hidden'); effectLayer.innerHTML = <div class="absolute inset-0 flex items-center justify-center"><div class="w-64 h-64 border-8 border-yellow-400 rounded-full relative animate-pulse-slow"><div class="absolute inset-4 border-4 border-yellow-300 rounded-full"></div><div class="absolute inset-0 flex items-center justify-center">{Array(12).fill().map((_, i) => `&\#x3C;div class=&\#x22;absolute w-1 h-8 bg-yellow-400&\#x22; style=&\#x22;transform-origin: bottom center; transform: rotate({i*30}deg) translateY(-120px)"></div>).join('')}</div></div></div>;setTimeout(() => { effectLayer.classList.add('hidden'); effectLayer.innerHTML = ''; }, 1500);}function showGoldenPalmEffect() {effectLayer.classList.remove('hidden');effectLayer.innerHTML = <div class="absolute inset-0 flex items-center justify-center"><div class="w-80 h-80 bg-yellow-500/70 rounded-lg transform rotate-45 animate-fire" style="clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);"></div></div>;setTimeout(() => { effectLayer.classList.add('hidden'); effectLayer.innerHTML = ''; }, 1500);}function showDragonEffect() {effectLayer.classList.remove('hidden');effectLayer.innerHTML = <div class="absolute inset-0"><div class="w-full h-full bg-black/70 absolute"></div><div class="absolute bottom-0 left-0 w-full h-1/3 bg-gradient-to-t from-yellow-500/50 to-transparent animate-fire"></div></div>;setTimeout(() => {effectLayer.innerHTML = <div class="absolute inset-0"><div class="w-full h-full bg-black/70 absolute"></div><div class="absolute bottom-0 left-0 w-full h-1/2 bg-gradient-to-t from-yellow-500/70 to-transparent animate-wave"></div></div>;setTimeout (() => { effectLayer.classList.add ('hidden'); effectLayer.innerHTML = ''; }, 1000);}, 1200);}function showPagodaEffect () {effectLayer.classList.remove ('hidden');// 雷峰塔特效：法海金光、黑塔、藍            &#x3C;div class=&#x22;absolute inset-0&#x22;&#x3E;
                &#x3C;!-- &#x9ED1;&#x8272;&#x70CF;&#x96F2;&#x80CC;&#x666F; --&#x3E;
                &#x3C;div class=&#x22;absolute inset-0 bg-black/80&#x22;&#x3E;&#x3C;/div&#x3E;

                <!-- 黑色風環繞 -->色閃電、黑色烏雲、黑色風effectLayer.innerHTML = `                    &#x3C;div class=&#x22;absolute top-[10%] left-[45%] w-2 h-64 bg-blue-400/80&#x22; 
                         style=&#x22;clip-path: polygon(0 0, 100% 30%, 0 60%, 100% 100%); transform: rotate(${Math.random()*10-5}deg); animation: lightning 0.5s ease-in-out infinite;&#x22;&#x3E;&#x3C;/div&#x3E;
                &#x60;).join(&#x27;&#x27;)}
            &#x3C;/div&#x3E;
        &#x60;;
        setTimeout(() =&#x3E; { effectLayer.classList.add(&#x27;hidden&#x27;); effectLayer.innerHTML = &#x27;&#x27;; }, 2500);
    }
    window.onload = initGame;
&#x3C;/script&#x3E;</body></html>
